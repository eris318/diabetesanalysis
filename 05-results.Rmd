# Results

```{r}
# 1st plot: map
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(choroplethr)
library(choroplethrMaps)

diabetes1$Percentage <- as.numeric(diabetes1$Percentage)

df_diabetes1 <- diabetes1 %>% 
  filter(Year=="2018") %>% 
  transmute(region = tolower(`State`), value = Percentage) %>% 
  as.data.frame()
state_choropleth(df_diabetes1,num_colors = 1)
```



```{r, fig.height=6, fig.width=10}
# 2nd plot: time series facet plot
low <- df_diabetes1[order(df_diabetes1$value),]$region[1:6]
high <- df_diabetes1[order(df_diabetes1$value,decreasing=T),]$region[1:6]

library(ggplot2)
library(zoo)
library(forcats)
df_diabetes2 <- diabetes1 %>%
  dplyr::select(Year,State,Percentage) %>% 
  filter(State=="Colorado"|State=="Utah"|State=="Massachusetts"|State=="Wisconsin"|
           State=="Wyoming"|State=="West Virginia"|State=="Alabama"|State=="Mississippi"|
           State=="Louisiana"|State=="Arkansas")
df_diabetes2$Year <- as.numeric(df_diabetes2$Year)
df_diabetes2$State <- fct_relevel(df_diabetes2$State,"Colorado","Utah","Massachusetts",
                                  "Wisconsin","Wyoming","West Virginia","Alabama",
                                  "Mississippi","Louisiana","Arkansas")
ggplot(df_diabetes2,aes(Year,Percentage))+
  geom_line()+
  facet_wrap(~State,nrow=2)

```

```{r, fig.height=6, fig.width=8}
# 3rd plot: cleveland dot plot
death_state <- death %>% 
  group_by(State) %>% 
  summarise(Freq=sum(Deaths)/sum(Population)*100000)
ggplot(death_state, aes(x = Freq, y = forcats::fct_reorder(State, Freq))) +
  geom_point(color = "blue") +
  ggtitle("Death due to Diabetes per 100000 People") +
  xlab("Number of Deaths")+
  ylab("") +
  theme_linedraw()
```

```{r}
# 4th plot: mosaic
library(magrittr)
age_2018 <- age %>% filter(Year=="2018")
age_2018 <- age_2018[,-1]
age_2018 <- cbind(Diabetes=c("Yes"),age_2018)
age_2018[nrow(age_2018)+1,] <- c("No",100-age_2018[[2]],100-age_2018[[3]],
                                 100-age_2018[[4]],100-age_2018[[5]])
age_2018$`18-44` <-  as.numeric(age_2018$`18-44`)
age_2018$`45-64` <-  as.numeric(age_2018$`45-64`)
age_2018$`65-74` <-  as.numeric(age_2018$`65-74`)
age_2018$over74 <-  as.numeric(age_2018$over74)

gender_2018 <- gender %>% filter(Year=="2018")
gender_2018 <- gender_2018[,-1]
gender_2018 <- cbind(Diabetes=c("Yes"),gender_2018)
gender_2018[nrow(gender_2018)+1,] <- c("No",100-gender_2018[[2]],100-gender_2018[[3]])
gender_2018$Male <-  as.numeric(gender_2018$Male)
gender_2018$Female <-  as.numeric(gender_2018$Female)

race_2018 <- race %>% filter(Year=="2018")
race_2018 <- race_2018[,-1]
race_2018 <- cbind(Diabetes=c("Yes"),race_2018)
race_2018[nrow(race_2018)+1,] <- c("No",100-race_2018[[2]],100-race_2018[[3]],
                                 100-race_2018[[4]],100-race_2018[[5]])
race_2018$White<-  as.numeric(race_2018$White)
race_2018$Black <-  as.numeric(race_2018$Black)
race_2018$Asian <-  as.numeric(race_2018$Asian)
race_2018$Hispanic <-  as.numeric(race_2018$Hispanic)

education_2018 <- education %>% filter(Year=="2018")
education_2018 <- education_2018[,-1]
education_2018 <- cbind(Diabetes=c("Yes"),education_2018)
education_2018[nrow(education_2018)+1,] <- c("No",100-education_2018[[2]],100-education_2018[[3]],100-education_2018[[4]])
education_2018$`< High School`<-  as.numeric(education_2018$`< High School`)
education_2018$`High School` <-  as.numeric(education_2018$`High School`)
education_2018$`> High School` <-  as.numeric(education_2018$`> High School`)


age_mosaic <- age_2018 %>%
  gather(key = "Age", value = "Freq", -Diabetes)
gender_mosaic <- gender_2018 %>%
  gather(key = "Gender", value = "Freq", -Diabetes)
race_mosaic <- race_2018 %>%
  gather(key = "Race", value = "Freq", -Diabetes)
education_mosaic <- education_2018 %>%
  gather(key = "Education", value = "Freq", -Diabetes)

race_mosaic$Race <- forcats::fct_relevel(race_mosaic$Race,"White","Black","Asian","Hispanic")
education_mosaic$Education <- forcats::fct_relevel(education_mosaic$Education,"< High School",
                                          "High School","> High School")
```

```{r, fig.height=10, fig.width=10}
# 4th plot: mosaic plot
library(gridExtra)
library(vcd)
g1 <- grid.grabExpr(mosaic(Diabetes ~ Age, direction = c("v", "h"), age_mosaic,
       highlighting_fill = c("grey80", "cornflowerblue")))
g2 <- grid.grabExpr(mosaic(Diabetes ~ Gender, direction = c("v", "h"), gender_mosaic,
       highlighting_fill = c("grey80", "cornflowerblue")))
g3 <- grid.grabExpr(mosaic(Diabetes ~ Race, direction = c("v", "h"), race_mosaic,
       highlighting_fill = c("grey80", "cornflowerblue")))
g4 <- grid.grabExpr(mosaic(Diabetes ~ Education, direction = c("v", "h"), education_mosaic,
       highlighting_fill = c("grey80", "cornflowerblue")))
grid.arrange(g1,g2,g3,g4)
```
```{r}
# 5th plot: histogram
library(foreign)
questionnaire18 <- read.xport("17_18.XPT")
diabetes_yes <- questionnaire18[questionnaire18$DIQ010==1,]
diabetes_first_age <- diabetes_yes[!is.na(diabetes_yes$DID040),]
diabetes_first_age1 <- diabetes_first_age[!diabetes_first_age$DID040==999,]
diabetes_first_age1 <- diabetes_first_age1[!diabetes_first_age1$DID040==666,]

ggplot(diabetes_first_age1, aes(DID040)) +
  geom_histogram(bins = 40,color = "wheat4", fill = "pink")+
  ggtitle("Age when first told you had diabetes")+
  xlab("Age")

```

```{r}
# 6th plot: boxplot
A1C_level <- diabetes_yes[!is.na(diabetes_yes$DIQ280),]
A1C_level <- A1C_level[!A1C_level$DIQ280==777,]
A1C_level <- A1C_level[!A1C_level$DIQ280==999,]
A1C_level <- A1C_level[!is.na(A1C_level$DID260),]
A1C_level <- A1C_level[!A1C_level$DID260==999,]
A1C_level <- A1C_level %>% 
  dplyr::select(DIQ280,DID260)
A1C_level$DID260 <- as.character(A1C_level$DID260)
A1C_level$DID260 <- fct_relevel(A1C_level$DID260,"0","1","2","3","4","5","6","7","10")
ggplot(A1C_level, aes(DID260, DIQ280)) + 
  geom_boxplot() + 
  ylab("A1C level")+
  xlab("Times of checking blood sugar")+
  theme_grey(16)

```

```{r}
# 7th plot: parallel coordinate plot
diabetes_parallel <- left_join(DiagnosedDiabetes,Obesity)
diabetes_parallel <- left_join(diabetes_parallel,PhysicalActivity)
colnames(diabetes_parallel) <- c("Year","County_FIPS","County","State","Diagnosed.Diabetes",
                                 "SVI","Obesity","Physical.Inactivity")
library(GGally) 
set.seed(0)
diabetes_parallel <- diabetes_parallel%>% slice_sample(n = 200)
ggparcoord(diabetes_parallel, columns = c(5,7,6,8),alphaLines = 0.4)+
  theme_grey(16)
```


